# GIS Data Integration API Documentation\n\n## Overview\n\nThe Sustainable Urban Studio backend provides comprehensive API endpoints for accessing authoritative GIS datasets for urban planning and sustainability analysis. The API integrates with multiple data sources and provides caching, rate limiting, and progress tracking capabilities.\n\n## Base URL\n```\nhttp://localhost:3001/api/gis\n```\n\n## Data Sources\n\n### 1. Natural Earth Data\n**Endpoint Prefix:** `/naturalearth`  \n**Description:** Global administrative boundaries, physical features, and base mapping layers\n\n### 2. OpenStreetMap (via Geofabrik)\n**Endpoint Prefix:** `/geofabrik`  \n**Description:** Road networks, buildings, land use, and points of interest\n\n### 3. U.S. Census Bureau TIGER/Line\n**Endpoint Prefix:** `/census`  \n**Description:** US administrative boundaries, demographics, and census geography\n\n### 4. Municipal Open Data\n**Endpoint Prefix:** `/municipal`  \n**Description:** Local government data from NYC, San Francisco, Los Angeles, and California\n\n### 5. Microsoft Building Footprints\n**Endpoint Prefix:** `/microsoft-buildings`  \n**Description:** 1.4 billion global building polygons for urban density analysis\n\n## Authentication & Rate Limiting\n\n- **General API Rate Limit:** 100 requests per 15 minutes per IP\n- **Data Download Rate Limit:** 10 downloads per hour per IP\n- **External API Rate Limits:** Vary by data source (automatically managed)\n\n## Common Parameters\n\n### Query Parameters\n- `targetCRS` - Target coordinate reference system (default: 'EPSG:4326')\n- `forceRefresh` - Force fresh download (bypass cache)\n- `category` - Filter by data category\n\n### Body Parameters for Downloads\n```json\n{\n  \"jobId\": \"optional-progress-tracking-id\",\n  \"forceRefresh\": false,\n  \"targetCRS\": \"EPSG:4326\",\n  \"bounds\": {\n    \"minLon\": -74.1,\n    \"minLat\": 40.6,\n    \"maxLon\": -73.9,\n    \"maxLat\": 40.8\n  }\n}\n```\n\n## Natural Earth Data Endpoints\n\n### Get Available Datasets\n```http\nGET /api/gis/naturalearth/datasets?category=administrative\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": [\n    {\n      \"id\": \"admin-0-countries\",\n      \"name\": \"Countries (1:110m)\",\n      \"description\": \"World country boundaries at 1:110 million scale\",\n      \"category\": \"administrative\",\n      \"url\": \"https://naturalearth.s3.amazonaws.com/110m_cultural/ne_110m_admin_0_countries.zip\"\n    }\n  ],\n  \"source\": \"Natural Earth\"\n}\n```\n\n### Download Dataset\n```http\nPOST /api/gis/download/naturalearth/admin-0-countries\nContent-Type: application/json\n\n{\n  \"jobId\": \"progress-123\",\n  \"targetCRS\": \"EPSG:4326\"\n}\n```\n\n### Get Dataset by Bounds\n```http\nGET /api/gis/naturalearth/admin-0-countries/bounds?minLon=-180&minLat=-90&maxLon=180&maxLat=90\n```\n\n### Search Dataset\n```http\nPOST /api/gis/naturalearth/admin-0-countries/search\nContent-Type: application/json\n\n{\n  \"searchParams\": {\n    \"NAME\": \"United*\",\n    \"CONTINENT\": \"North America\"\n  }\n}\n```\n\n## OpenStreetMap/Geofabrik Endpoints\n\n### Get Available Regions\n```http\nGET /api/gis/geofabrik/regions\n```\n\n### Get Available Layers\n```http\nGET /api/gis/geofabrik/layers?category=transportation\n```\n\n### Download Regional Data\n```http\nPOST /api/gis/download/geofabrik/us/california\nContent-Type: application/json\n\n{\n  \"layers\": [\"roads\", \"buildings\", \"railways\"],\n  \"jobId\": \"osm-ca-download\",\n  \"filters\": {\n    \"roads\": {\n      \"highway\": [\"motorway\", \"trunk\", \"primary\"]\n    }\n  }\n}\n```\n\n### Get Specific Layer\n```http\nGET /api/gis/geofabrik/us/california/roads\n```\n\n### Search Region\n```http\nPOST /api/gis/geofabrik/us/california/search\nContent-Type: application/json\n\n{\n  \"searchParams\": {\n    \"name\": \"*Francisco*\"\n  },\n  \"layers\": [\"places\", \"buildings\"]\n}\n```\n\n## Census Bureau TIGER Endpoints\n\n### Get Available Datasets\n```http\nGET /api/gis/census/datasets?category=administrative\n```\n\n**Response includes:**\n- Available datasets with state requirements\n- Available years (current and previous 4 years)\n- Available states with FIPS codes\n\n### Download Dataset\n```http\nPOST /api/gis/download/census/tracts\nContent-Type: application/json\n\n{\n  \"year\": 2023,\n  \"stateCode\": \"CA\",\n  \"includeDemographics\": true,\n  \"jobId\": \"census-tracts-ca\"\n}\n```\n\n## Municipal Open Data Endpoints\n\n### Get Available Data Sources\n```http\nGET /api/gis/municipal/sources\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": [\n    {\n      \"id\": \"nyc\",\n      \"name\": \"NYC Open Data\",\n      \"baseUrl\": \"https://data.cityofnewyork.us/api/geospatial\",\n      \"datasets\": [\n        {\n          \"id\": \"zoning\",\n          \"name\": \"Zoning Districts\",\n          \"description\": \"NYC zoning district boundaries\",\n          \"category\": \"zoning\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n### Get Municipality Datasets\n```http\nGET /api/gis/municipal/nyc/datasets\n```\n\n### Download Municipal Dataset\n```http\nPOST /api/gis/download/municipal/nyc/zoning\nContent-Type: application/json\n\n{\n  \"jobId\": \"nyc-zoning\",\n  \"filters\": {\n    \"ZONEDIST\": \"R*\"\n  }\n}\n```\n\n### Search Municipal Data\n```http\nPOST /api/gis/municipal/nyc/search\nContent-Type: application/json\n\n{\n  \"searchParams\": {\n    \"name\": \"*park*\"\n  },\n  \"datasets\": [\"parks\", \"neighborhoods\"]\n}\n```\n\n### Get Datasets by Category\n```http\nGET /api/gis/municipal/category/zoning\n```\n\n## Microsoft Building Footprints Endpoints\n\n### Get Available Regions\n```http\nGET /api/gis/microsoft-buildings/regions\n```\n\n### Get Analysis Types\n```http\nGET /api/gis/microsoft-buildings/analysis-types\n```\n\n### Download Building Footprints\n```http\nPOST /api/gis/download/microsoft-buildings/ca\nContent-Type: application/json\n\n{\n  \"fileKey\": \"california\",\n  \"jobId\": \"buildings-ca\",\n  \"bounds\": {\n    \"minLon\": -122.5,\n    \"minLat\": 37.7,\n    \"maxLon\": -122.3,\n    \"maxLat\": 37.8\n  },\n  \"sampleSize\": 10000,\n  \"maxFeatures\": 50000\n}\n```\n\n### Perform Density Analysis\n```http\nPOST /api/gis/microsoft-buildings/ca/density-analysis\nContent-Type: application/json\n\n{\n  \"gridSize\": 1000,\n  \"bounds\": {\n    \"minLon\": -122.5,\n    \"minLat\": 37.7,\n    \"maxLon\": -122.3,\n    \"maxLat\": 37.8\n  }\n}\n```\n\n## Progress Tracking\n\n### Get Download Progress\n```http\nGET /api/gis/progress/job-123\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"id\": 1,\n    \"job_id\": \"job-123\",\n    \"source_name\": \"naturalearth\",\n    \"data_type\": \"admin-0-countries\",\n    \"status\": \"in_progress\",\n    \"progress\": 75,\n    \"total_size\": 1048576,\n    \"downloaded_size\": 786432,\n    \"error_message\": null,\n    \"created_at\": \"2024-01-01T12:00:00Z\",\n    \"updated_at\": \"2024-01-01T12:05:00Z\"\n  }\n}\n```\n\n**Status Values:**\n- `pending` - Download queued\n- `downloading` - Data download in progress\n- `extracting` - File extraction in progress\n- `processing` - Data processing in progress\n- `completed` - Successfully completed\n- `failed` - Download failed (check error_message)\n\n## Utility Endpoints\n\n### Get Dataset Information\n```http\nGET /api/gis/naturalearth/admin-0-countries/info\nGET /api/gis/municipal/nyc/zoning/info\n```\n\n### Cache Management\n```http\nGET /api/gis/cache/stats\nPOST /api/gis/cache/clear\n```\n\n### Rate Limiting Status\n```http\nGET /api/gis/rate-limit/status\n```\n\n## Response Formats\n\n### Success Response\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"type\": \"FeatureCollection\",\n    \"features\": [...],\n    \"metadata\": {\n      \"source\": \"Natural Earth\",\n      \"dataset\": \"Countries (1:110m)\",\n      \"downloadedAt\": \"2024-01-01T12:00:00Z\",\n      \"totalFeatures\": 195\n    },\n    \"statistics\": {\n      \"totalFeatures\": 195,\n      \"geometryTypes\": {\n        \"Polygon\": 195\n      },\n      \"bbox\": {\n        \"minLon\": -180,\n        \"minLat\": -90,\n        \"maxLon\": 180,\n        \"maxLat\": 83.64\n      }\n    }\n  },\n  \"cached\": true\n}\n```\n\n### Error Response\n```json\n{\n  \"success\": false,\n  \"error\": \"Dataset not found: invalid-dataset-id\"\n}\n```\n\n## Data Categories\n\n- **administrative** - Boundaries and administrative divisions\n- **transportation** - Roads, railways, airports, public transit\n- **physical** - Coastlines, water bodies, terrain\n- **cultural** - Cities, places, populated areas\n- **environmental** - Protected areas, flood zones, climate data\n- **zoning** - Land use and zoning districts\n- **housing** - Affordable housing, residential areas\n- **recreation** - Parks, open space, recreational facilities\n- **education** - Schools, universities, educational facilities\n- **buildings** - Building footprints and structures\n- **landuse** - Land cover and land use classifications\n- **natural** - Natural features and conservation areas\n- **amenities** - Points of interest, services, facilities\n- **census** - Demographic and statistical boundaries\n- **hydrography** - Water features and watersheds\n\n## Performance Considerations\n\n1. **Caching:** All responses are cached to improve performance\n2. **Sampling:** Large datasets support sampling parameters\n3. **Bounds Filtering:** Spatial filtering reduces data size\n4. **Progress Tracking:** Monitor large downloads with job IDs\n5. **Rate Limiting:** Automatic throttling of external API calls\n\n## Error Handling\n\nCommon HTTP status codes:\n- `200` - Success\n- `400` - Bad request (invalid parameters)\n- `404` - Dataset or resource not found\n- `429` - Rate limit exceeded\n- `500` - Internal server error\n\n## Example Usage Workflows\n\n### Urban Planning Analysis\n1. Download administrative boundaries from Natural Earth\n2. Get building footprints from Microsoft\n3. Overlay with zoning data from municipal sources\n4. Add transportation networks from OpenStreetMap\n5. Include demographic data from Census TIGER\n\n### Sustainability Assessment\n1. Get land use data from municipal sources\n2. Download protected areas and environmental zones\n3. Add building density analysis\n4. Include transportation accessibility\n5. Overlay with climate risk data\n\n## Support\n\nFor questions or issues with the GIS Data Integration API, please refer to the project documentation or create an issue in the repository."